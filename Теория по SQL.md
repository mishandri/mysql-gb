# Основы SQL

## 01. Общие команды mysql

### Подключение

Подключение к mysql на самом сервере. Параметр u отвечает за имя пользователя, p - запрос пароль.

```bash
mysql -u root -p
```

Подключение к mysql с другого компьютера. Параметр h указывает сервер, P - порт.

```bash
mysql -u root -h 192.168.1.36-P 3306-p
```

### Команды mysql

```sql
USE     \u  -- Выбор БД
SOURCE  \.  -- Выполнение SQL-команд из файла
SYSTEM  \!  -- Выполнение команды ОС
STATUS  \s  -- Вывод имнформации о состоянии сервера
EXIT    \q  -- выход
	\G  -- Вывод информации в вертикальном формате. Только для самого клиента mysql, а не других программ
```

### Создание дампа для бэкапа

```bash
mysqldump -u root -p mysql > mysql.sql
```

### Восстановление дампа

```bash
mysql -u root -p mysql 
```

Чтобы не вводить каждый раз пользователя и пароль, можно создать файл `.my.cnf` в папке запуска (дамашней папке)

### Настройка подключения

Для подключения самого mysql:

```plaintext
[mysql]
user=root
password=123
```

Если хочешь оставить пароль внутри, то надо ограничить доступ, оставить только для текущего пользователя: `chmod 0600 ~/.my.cnf`

Для подключения всех клиентов:

```plaintext
[client]
user=root
password=123
```

### Основные команды с БД

Просмотр всех БД

```sql
SHOW DATABASES;
```

Создание БД

```sql
CREATE DATABASE shop;
```

Создание БД с проверкой на существование

```sql
CREATE DATABASE IF NOT EXISTS shop;
```

Каталог данных

```sql
SHOW VARIABLES LIKE'datadir';
```

Удаление БД

```sql
DROP DATABASE shop;
```

Удаление БД с проверкой на существование

```sql
DROP DATABASE IF EXISTS shop;
```

Выбрать БД по умолчанию

```sql
USE shop
```

Можно не указывать USE, но тогда нужно всегда писать FROM

```sql
SHOW TABLES FROM shop
```

Подключиться сразу к БД

```bash
mysql shop
```

### Основные команды с таблицами

Создание таблиц

```sql
CREATE TABLE users (k INT);
```

Показать все таблицы в БД

```sql
SHOW TABLES;
```

Подробный вывод для конкретной таблицы

```sql
DESCRIBE user;
```

Подробный вывод для интересующего столбца таблицы

```sql
DESCRIBE user 'User';
```

Подробный вывод столбцов таблицы, начинающихся на m

```sql
DESCRIBE user 'm%';
```

*Примечание: SHOW и DESCRIBE являются не стандартными, другие БД их могут не иметь.*

Поэтому всегда можно воспользоваться стандартными средствами:

```sql
SELECT * FROM information_schema.SCHEMA; --information_schema - виртуальная БД
```

Вывод таблицы

```sql
SELECT * FROM information_schema.TABLESWHERE TABLE_SCHEMA ='shop'\G; -- \G только в mysql
```

## 02. Язык SQL

SQL - Structured Query Language

### Достоинства SQL

* Декларативый язык. Описываем цель, а не инструкцию алгоритма;
* Высокоуровнева структура, напоминающая естественный язык;
* Высокая эффективность обработки множеств;
* Независимость от конкретных СУБД;
* Межплатформенная переносимость;
* Наличие стандартов.

### Недостатки SQL

* Слабоструктурированный язык;
* Старый язык. С современной точки зрения он не очень удобен;
* Плохое взаимодействие с ООП-языками;
* Не универсальный язык. Нельзя создать независимую программу;
* Множество диалектов.

### Элементы языка

* Коментарии
* Скалярные выражения (константы)
* Ключевые слова
* Операторы
* Таблицы
* Столбцы
* Индексы
* Предопределенные функции
* Представления
* Переменные
* Хранимые процедуры
* Хранимые функции
* Триггеры
* Коды ошибок

### Коментарии

Однострочные

```sql
-- Это однострочный коментарий
```

Многострочные

```sql
/* Многострочный
коментарий */
```

### Инструкции

**DDL (Data Definition Language)** - язык описания данных. Инфструкции создания, редактирования и удаления БД и таблиц. Опреаторы, позволяющие воссоздать структуру БД.

**DML (Data Manipulation Language)** - язык управления данными. Инфструкции создания, редактирования, удаления и извлечения данных из таблиц. Операторы, обслуживающие данные, хранящиеся в БД.

Каждая инструкция начинается с ключевого слова, которая описывает выполняемые дейтсвия.

### Типы данных

Тип данных определяет характеристики значений и количество памяти, выделяемой под хранение.

* Числовые
* Строковые
* NULL
* Календарные
* Коллекции

Типы могут сопровождаться дополнительными атрибутами, которые задают ограничение на столбец:

* NULL (позволяет неопределенные значения) или NOT NULL (запрещает неопределенные значения)
* DEFAULT (позволяет задать значение по умолчанию)
* UNSIGNED (беззнаковое числовое поле)

**Числовые типы:**

* Целочисленные (быстрая обработка) TINYINT (1 байт), SMALLINT (2 байта), MEDIUMINT (3 байта), INT (4 байта), BIGINT (8 байт)
* Вещественные (средняя обработка) FLOAT (4 байта), DOUBLE (8 байт)
* Точные (медленная обработка) DECIMAL (зависит от объявления). DECIMAL(7,4) 7 байт под целую часть, 4 байта под дробную часть

**Строковые типы:**

* Фиксированные CHAR (40 символов по умолчанию)
* Переменные VARCHAR (ровно по количеству символов)
* BLOB-строка TINYTEXT (256 символов), TEXT (65536 символов), MEDIUMTEXT (16777216/16МБ), LONGTEXT (4294967296/4ГБ)

**Календарные типы:**

* TIME - хранение времени в течении суток
* YEAR - хранит год
* DATE - хранит дату с точностью до дня
* DATETIME - хранит дату и время
* TIMESTAMP - хранит дату и время (1970 - 2038)

| Тип    | Формат          | Кол-во байт |
| --------- | --------------------- | -------------------- |
| YEAR      | 0000                  | 1                    |
| DATE      | '0000-00-00'          | 3                    |
| TIME      | '00:00:00'            | 3                    |
| DATETIME  | '0000-00-00 00:00:00' | 4                    |
| TIMESTAMP | '0000-00-00 00:00:00' | 8                    |

**Особые типы данных**

* ENUM - поле принимает одно значение из списка
* SET - поле принимает комбинацию значений из списка
* JSON - коллекция данных (похожи на словари python)

**Индексы**
